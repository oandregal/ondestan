<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      i18n:domain="Ondestan">

  <head>
    <tal:block metal:define-slot="head"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
    <meta name="keywords" content="web python pyramid pylons cows gps monitoring sqlalchemy geoalchemy2" />
    <meta name="description" content="cows position monitoring web app" />
    <link rel="stylesheet"
          href="${request.static_url('ondestan:static/bootstrap-3.1.1-dist/css/bootstrap.css')}"
          type="text/css" media="screen" charset="utf-8" />
    <link rel="stylesheet"
          href="${request.static_url('ondestan:static/css/main.css')}"
          type="text/css" media="screen" />
    <tal:block metal:define-slot="styles"/>
  </head>

  <?python from ondestan.security import get_user_login; from ondestan.services.order_service import get_orders, get_orders_popover ?>
  <body tal:define="user_id get_user_login(request); orders get_orders(request); orders_popover_content get_orders_popover(request, orders)">

	<div class="container">
	    <div class="header">
	      <ul tal:condition="user_id != None" class="nav navbar-nav pull-right">
            <li id="new_devices"><a href="${request.route_url('orders')}">${len(orders)} <span i18n:translate="orders_menu">order(s)</span></a></li>
	        <li class="dropdown active">
	          <a href="#" class="dropdown-toggle" data-toggle="dropdown">${user_id} <b class="caret"></b></a>
	          <ul class="dropdown-menu">
	            <li><a href="${request.route_url('update_profile')}" i18n:translate="update_profile">Update profile</a></li>
	            <li><a href="${request.route_url('notifications')}" i18n:translate="notifications_log">Notifications Log</a></li>
	            <li><a href="${request.route_url('logout')}" i18n:translate="logout">Logout</a></li>
	          </ul>
	        </li>
	      </ul>
	      <ul tal:condition="user_id == None" class="nav navbar-nav pull-right">
	        <li class="dropdown active">
	          <a href="#" class="dropdown-toggle big-font" data-toggle="dropdown"><span i18n:translate="log_in">Log in</span> <b class="caret"></b></a>
			  <form class="form-signin dropdown-menu dropdown-menu-right" role="form" action="${request.route_url('login')}" method="post">
				  <span tal:replace="message"/>
				  <input type="hidden" name="came_from" value="${came_from}"/>
				  <input type="text" class="form-control" placeholder="Usuario" name="login" value="${login}" autofocus="autofocus"/>
				  <input type="password" class="form-control" placeholder="Contraseña" name="password" />
				  <input class="btn btn-block btn-primary" type="submit" name="form.submitted" i18n:attributes="value log_in" value="Log in"/>
				  <a href="${request.route_url('reminder')}" class="small-font" i18n:translate="remember_user_password">Remember user/pass</a>
				  <br/>
				  <br/>
				  <a class="btn btn-primary" href="${request.route_url('signup')}" i18n:translate="sign_up">Sign Up</a>
			  </form>
	        </li>
	      </ul>
	      <h3 class="text-muted"><a href="${request.route_url('default')}">Onde Están</a></h3>
	    </div>

		<div class="col-md-10 col-md-offset-1">
	    <tal:block metal:define-slot="content"/>
		    <div class="footer">
		   		<tal:block metal:define-slot="footer"/>
		   		<a href="http://www.cesareox.com/info_contacto/" i18n:translate="contact">Contact</a> | <a href="http://www.cesareox.com/trabajo/proyectos/oe" i18n:translate="about">About</a>
		    </div>
	    </div>
    </div>
    <div>
    	<script type="text/javascript" src="${request.static_url('ondestan:static/js/lib/jquery-1.8.2.min.js')}"></script>
    	<script type="text/javascript" src="${request.static_url('ondestan:static/bootstrap-3.1.1-dist/js/bootstrap.js')}"></script>
	    <script type="text/javascript">
	      window.contextVariables = {};
		  window.contextVariables.orders_popover_content = "${orders_popover_content}";
	    </script>
    	<script type="text/javascript" src="${request.static_url('ondestan:static/js/main.js')}"></script>
    	<tal:block metal:define-slot="javascript"/>
    </div>
  </body>

</html>
