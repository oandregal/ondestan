<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      i18n:domain="Ondestan" metal:use-macro="load: main.pt">

  <tal:block metal:fill-slot="head">
    <title i18n:translate="simple_viewer_title">Viewer - Ondest√°n</title>
  </tal:block>

  <tal:block metal:fill-slot="styles">
    <link rel="stylesheet" href="${request.static_url('ondestan:static/styles/leaflet.css')}" />
    <link rel="stylesheet" href="${request.static_url('ondestan:static/styles/leaflet.draw.css')}" />
  </tal:block>

  <tal:block metal:fill-slot="javascript">
    <script type="text/javascript" src="${request.static_url('ondestan:static/js/lib/leaflet.js')}"></script>
    <script type="text/javascript" src="${request.static_url('ondestan:static/js/lib/leaflet.ajax.min.js')}"></script>
    <script type="text/javascript" src="${request.static_url('ondestan:static/js/lib/leaflet.draw.js')}"></script>
  	<?python from ondestan.config import Config; from ondestan.security import check_permission?>
    <script type="text/javascript">
      window.contextVariables.is_admin = ${str(is_admin).lower()};
      window.contextVariables.animals_json_url = "${request.route_url('json_animals')}";
      window.contextVariables.plots_json_url = "${request.route_url('json_plots')}";
      window.contextVariables.create_plot_url = "${request.route_url('create_plot')}";
      window.contextVariables.update_plot_geom_url = "${request.route_url('update_plot_geom')}";
      window.contextVariables.delete_plot_url = "${request.route_url('delete_plot')}";
      window.contextVariables.orders_popover_content = "${orders_popover_content}";
      window.contextVariables.activate_device_msg = "<tal:block i18n:translate="activate">Activate</tal:block>";
      window.contextVariables.deactivate_device_msg = "<tal:block i18n:translate="deactivate">Deactivate</tal:block>";
      window.contextVariables.activate_device_url = "${request.route_url('activate_device', device_id='__device_id__')}";
      window.contextVariables.deactivate_device_url = "${request.route_url('deactivate_device', device_id='__device_id__')}";
      window.contextVariables.update_animal_name_url = "${request.route_url('update_animal_name')}";
      window.contextVariables.edit_image_tooltip = "<tal:block i18n:translate="edit_animal_name_tooltip">Activate</tal:block>";
      window.contextVariables.low_battery_barrier = ${Config.get_float_value('config.low_battery_barrier')};
      window.contextVariables.medium_battery_barrier = ${Config.get_float_value('config.medium_battery_barrier')};
      window.contextVariables.map_view_json = ${view if view != None else 'null'};
      window.contextVariables.default_view = [${Config.get_string_value('config.default_view')}];
      window.contextVariables.edit_name_tooltip = "<tal:block i18n:translate="edit_name_tooltip">Double click to edit name (confirm change by pressing enter).</tal:block>";
      
      window.contextVariables.zoom_in_tooltip = "<tal:block i18n:translate="map_tool_zoom_in_tooltip">Zoom in</tal:block>";
      window.contextVariables.zoom_out_tooltip = "<tal:block i18n:translate="map_tool_zoom_out_tooltip">Zoom out</tal:block>";

      L.drawLocal.draw.toolbar.buttons.polygon = "<tal:block i18n:translate="map_tool_create_plot_tooltip">Draw a new plot</tal:block>";
      L.drawLocal.draw.toolbar.undo.title = "<tal:block i18n:translate="map_tool_undo_tooltip">Delete last point drawn</tal:block>";
      L.drawLocal.draw.toolbar.undo.text = "<tal:block i18n:translate="map_tool_undo_text">Delete last point</tal:block>";
      L.drawLocal.draw.toolbar.actions.title = "<tal:block i18n:translate="map_tool_cancel_text">Cancel drawing</tal:block>";
      L.drawLocal.draw.toolbar.actions.text = "<tal:block i18n:translate="map_tool_cancel_text">Cancel</tal:block>";
      L.drawLocal.draw.handlers.polygon.tooltip.start = "<tal:block i18n:translate="map_tool_create_plot_handler_start_tooltip">Click to start drawing plot.</tal:block>";
      L.drawLocal.draw.handlers.polygon.tooltip.cont = "<tal:block i18n:translate="map_tool_create_plot_handler_cont_tooltip">Click to continue drawing plot.</tal:block>";
      L.drawLocal.draw.handlers.polygon.tooltip.end = "<tal:block i18n:translate="map_tool_create_plot_handler_end_tooltip">Click first point to close this plot.</tal:block>";
      L.drawLocal.draw.handlers.polyline.error = "<tal:block i18n:translate="map_tool_edit_plot_handler_error">Error: plot edges cannot cross!</tal:block>";
      
      L.drawLocal.edit.toolbar.actions.save.title = "<tal:block i18n:translate="map_tool_save_tooltip">Save changes</tal:block>";
      L.drawLocal.edit.toolbar.actions.save.text = "<tal:block i18n:translate="map_tool_save_text">Save</tal:block>";
      L.drawLocal.edit.toolbar.actions.cancel.title = "<tal:block i18n:translate="map_tool_cancel_tooltip">Cancel editing, discards all changes</tal:block>";
      L.drawLocal.edit.toolbar.actions.cancel.text = "<tal:block i18n:translate="map_tool_cancel_text">Cancel</tal:block>";
      
      L.drawLocal.edit.toolbar.buttons.edit = "<tal:block i18n:translate="map_tool_edit_plot_tooltip">Edit plots</tal:block>";
      L.drawLocal.edit.toolbar.buttons.editDisabled = "<tal:block i18n:translate="map_tool_edit_plot_disabled_tooltip">No plots to edit</tal:block>";
      L.drawLocal.edit.toolbar.buttons.remove = "<tal:block i18n:translate="map_tool_delete_plot_tooltip">Delete plots</tal:block>";
      L.drawLocal.edit.toolbar.buttons.removeDisabled = "<tal:block i18n:translate="map_tool_delete_plot_disabled_tooltip">No plots to delete</tal:block>";
      L.drawLocal.edit.handlers.edit.tooltip.text = "<tal:block i18n:translate="map_tool_edit_plot_handler_tooltip">Drag handles to edit the plot.</tal:block>";
      L.drawLocal.edit.handlers.edit.tooltip.subtext = "<tal:block i18n:translate="map_tool_edit_plot_handler_subtooltip">Click Cancel to undo changes.</tal:block>";
      L.drawLocal.edit.handlers.remove.tooltip.text = "<tal:block i18n:translate="map_tool_delete_plot_handler_tooltip">Click on a plot to remove.</tal:block>";

      window.contextVariables.hide_show_draw_tools_tooltip = "<tal:block i18n:translate="hide_show_draw_tools_tooltip">Hide/show plot management tools</tal:block>";
      window.contextVariables.show_map_legend_tooltip = "<tal:block i18n:translate="map_legend">Map legend</tal:block>";
    </script>
    <script type="text/javascript" src="${request.static_url('ondestan:static/js/simpleViewer.js')}"></script>
  </tal:block>

  <tal:block metal:fill-slot="content">
  	<?python from ondestan.config import Config; from ondestan.security import check_permission?>

    <div class="row data">

	  	<div tal:condition="len(notifications) > 0" class="alerts-panel">
	  		<tal:block tal:repeat="notification notifications">
	  			${notification.get_full_html(request)}
	  		</tal:block>
		</div>

      <div class="col-md-3 text-center col-md-offset-1 devices-block">
      	  <div class="devices-block-title">
		  	<h4 class="text-muted" align="center" i18n:translate="devices">Devices</h4>
		  </div>
	      <div class="col-md-6 devices-block-content">
	        <a href="#" id="active_devices" disabled="disabled">-</a>
	        <h5 i18n:translate="dashboard_active">Active</h5>
	      </div>
	      <div class="col-md-6 devices-block-content">
	        <a href="#" id="inactive_devices" disabled="disabled">-</a>
	        <h5 i18n:translate="dashboard_inactive">Inactive</h5>
	      </div>
      </div>
      <div class="col-md-3 text-center col-md-offset-4 devices-block">
      	  <div class="devices-block-title">
		  	<h4 class="text-muted" align="center" i18n:translate="alerts">Alerts</h4>
		  </div>
	      <div class="col-md-6 devices-block-content">
	        <a href="#" id="low_battery_devices" disabled="disabled">-</a>
	        <h5 i18n:translate="dashboard_low_battery">Low Battery</h5>
	      </div>
	      <div class="col-md-6 devices-block-content">
	        <a href="#" id="outside_plots_devices" disabled="disabled">-</a>
	        <h5 i18n:translate="dashboard_outside_plots">Outside Plots</h5>
	      </div>
      </div>
    </div>
    
	<!-- Select user modal -->
	<div tal:condition="is_admin" class="modal fade" id="user-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	  <div class="modal-dialog modal-sm modal-xsm">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
	        <h4 class="modal-title" id="myModalLabel" i18n:translate="select_plot_user_modal_title">Select plot owner</h4>
	      </div>
	      <div class="modal-body">
	      	<select id="user_selector">
			  <option selected="true" value=""> </option>
			  <option tal:repeat="user non_admin_users" tal:content="user.login" value="${user.id}"/>
			</select>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal" i18n:translate="cancel">Cancel</button>
	        <button id="accept_btn" type="button" class="btn btn-primary" disabled="true" i18n:translate="accept">Accept</button>
	      </div>
	    </div>
	  </div>
	</div>

	<!-- Legend modal -->	
	<div class="modal fade bs-example-modal-sm" id="legend-modal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
	  <div class="modal-dialog modal-sm">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
	        <h4 class="modal-title" id="myModalLabel" i18n:translate="map_legend">Map legend</h4>
	      </div>
	      <div class="modal-body">
	      	<h5 i18n:translate="battery_level_legend">Battery Level (color)</h5>
	      	<ul>
		      	<li>
		      		<div id="low-battery" class="circle" ></div><span><tal:block i18n:translate="low_battery_level">Low battery level</tal:block> (&lt; ${Config.get_float_value('config.low_battery_barrier')}%)</span>
		      	</li>
		      	<li>
		      		<div id="medium-battery" class="circle"></div><span><tal:block i18n:translate="medium_battery_level">Medium battery level</tal:block> (${Config.get_float_value('config.low_battery_barrier')}% - ${Config.get_float_value('config.medium_battery_barrier')}%)</span>
		      	</li>
		      	<li>
		      		<div id="high-battery" class="circle"></div><span><tal:block i18n:translate="high_battery_level">High battery level</tal:block> (&gt; ${Config.get_float_value('config.medium_battery_barrier')}%)</span>
		      	</li>
	      	</ul>
	      	<hr/>
	      	<h5 i18n:translate="inside_outside_plots_legend">Inside/Outside Plots (border)</h5>
	      	<ul>
		      	<li>
		      		<div id="inside-plots" class="circle"></div><span i18n:translate="inside_plots">Inside plots</span>
		      	</li>
		      	<li>
		      		<div id="outside-plots" class="circle"></div><span i18n:translate="outside_plots">Outside plots</span>
		      	</li>
	      	</ul>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal" i18n:translate="close">Close</button>
	      </div>
	    </div>
	  </div>
	</div>

    <div id="map"></div>

  </tal:block>

</html>
